{"version":3,"file":"index.cjs.js","sources":["../src/index.ts","../src/composables/useCache.ts"],"sourcesContent":["/**\n * Core Vue Storefront 2 library for enabling Server Side Rendering (SSR) cache.\n *\n * @remarks\n * The `@vue-storefront/cache` library is a Nuxt.js module, that is core piece required\n * to enable Server Side Rendering (SSR) cache in Vue Storefront 2. It uses drivers\n * to integration with specific caching solutions.\n *\n * @packageDocumentation\n */\n\nexport { useCache } from './composables/useCache';\n\nexport enum CacheTagPrefix {\n  Product = 'P',\n  Category = 'C',\n  Attribute = 'A',\n  Cart = 'B',\n  Filter = 'F',\n  Block = 'O',\n  View = 'V'\n}\n\nexport interface CacheTag {\n  prefix: CacheTagPrefix | string;\n  value: string;\n}\n\nexport type CacheDriver = (options: any) => {\n  invoke: () => Promise<any>;\n  invalidate: () => Promise<any>;\n}\n\nexport type SetTagsFn = (tags: CacheTag[]) => CacheTag[];\n\nexport interface UseCache {\n  addTags(tags: CacheTag[]): void;\n  clearTags(): void;\n  getTags(): CacheTag[];\n  setTags(callback: SetTagsFn): void;\n}\n","import { CacheTag, UseCache, SetTagsFn } from '..';\nimport { useContext } from '@nuxtjs/composition-api';\n\nexport const useCache = (): UseCache => {\n  const { req }: any = useContext();\n\n  if (!req) {\n    return {\n      addTags: () => {},\n      clearTags: () => {},\n      getTags: () => [],\n      setTags: () => {}\n    };\n  }\n\n  const $vsfCache = req.$vsfCache;\n  const addTags = (tags: CacheTag[]) => tags.forEach(tag => $vsfCache.tagsSet.add(tag));\n  const clearTags = () => $vsfCache.tagsSet.clear();\n  const getTags = (): CacheTag[] => Array.from($vsfCache.tagsSet);\n  const setTags = (fn: SetTagsFn) => {\n    const tagsSet = $vsfCache.tagsSet;\n    const newTags = fn(Array.from(tagsSet));\n    tagsSet.clear();\n    newTags.forEach(tag => tagsSet.add(tag));\n  };\n\n  return {\n    addTags,\n    clearTags,\n    getTags,\n    setTags\n  };\n};\n"],"names":["CacheTagPrefix","req","useContext","addTags","clearTags","getTags","setTags","$vsfCache","tags","forEach","tag","tagsSet","add","clear","Array","from","fn","newTags"],"mappings":"wEAaYA,uCAAAA,+BAAAA,EAAAA,yBAAAA,wCAEVA,eACAA,gBACAA,WACAA,aACAA,YACAA,4BCjBsB,WACd,IAAAC,EAAaC,mBAErB,IAAKD,EACH,MAAO,CACLE,QAAS,aACTC,UAAW,aACXC,QAAS,WAAM,MAAA,IACfC,QAAS,cAIb,IAAMC,EAAYN,EAAIM,UAWtB,MAAO,CACLJ,QAXc,SAACK,GAAqB,OAAAA,EAAKC,SAAQ,SAAAC,GAAO,OAAAH,EAAUI,QAAQC,IAAIF,OAY9EN,UAXgB,WAAM,OAAAG,EAAUI,QAAQE,SAYxCR,QAXc,WAAkB,OAAAS,MAAMC,KAAKR,EAAUI,UAYrDL,QAXc,SAACU,GACf,IAAML,EAAUJ,EAAUI,QACpBM,EAAUD,EAAGF,MAAMC,KAAKJ,IAC9BA,EAAQE,QACRI,EAAQR,SAAQ,SAAAC,GAAO,OAAAC,EAAQC,IAAIF"}